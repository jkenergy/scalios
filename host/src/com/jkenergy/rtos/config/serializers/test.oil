/* Test OIL File */


OIL_VERSION="2.5";

IMPLEMENTATION Standard {

#include "test1.oil"


	APPMODE {
	};

	TASK {
		BOOLEAN [
			TRUE {
				APPMODE_TYPE APPMODE[];
			},
			FALSE
		] AUTOSTART;

		UINT32 PRIORITY;
		UINT32 ACTIVATION;
		ENUM [NON, FULL] SCHEDULE;
		EVENT_TYPE EVENT[];
		RESOURCE_TYPE RESOURCE[];
		MESSAGE_TYPE MESSAGE[];
	};

	ISR {
		UINT32 [1, 2] CATEGORY;
		RESOURCE_TYPE RESOURCE[];
		MESSAGE_TYPE MESSAGE[];
	};
	
	COUNTER {
		UINT32 MINCYCLE;
		UINT32 MAXALLOWEDVALUE;
		UINT32 TICKSPERBASE;
	};
	
	ALARM {
		COUNTER_TYPE COUNTER;
		ENUM [
			ACTIVATETASK {
				TASK_TYPE TASK;
			},
			SETEVENT {
				TASK_TYPE TASK;
				EVENT_TYPE EVENT;
			},
			ALARMCALLBACK {
				STRING ALARMCALLBACKNAME;
			}
		] ACTION;
		BOOLEAN [
			TRUE {
				UINT32 ALARMTIME;
				UINT32 CYCLETIME;
				APPMODE_TYPE APPMODE[];
			},
			FALSE
		] AUTOSTART;
	};
	
	EVENT {
		UINT64 WITH_AUTO MASK;
	};
	
	RESOURCE {
		ENUM [
			STANDARD,
			LINKED {
				RESOURCE_TYPE LINKEDRESOURCE;
			},
			INTERNAL
		] RESOURCEPROPERTY;
	};	

	MESSAGE {
		ENUM [
			SEND_STATIC_INTERNAL {
				STRING CDATATYPE;
			},
			RECEIVE_UNQUEUED_INTERNAL {
				MESSAGE_TYPE SENDINGMESSAGE;
				UINT64 INITIALVALUE = 0;
			},
			RECEIVE_QUEUED_INTERNAL {
				MESSAGE_TYPE SENDINGMESSAGE;
				UINT32 QUEUESIZE;
			}
		] MESSAGEPROPERTY;

		ENUM [
			NONE,
			ACTIVATETASK {
				TASK_TYPE TASK;
			},
			SETEVENT {
				TASK_TYPE TASK;
				EVENT_TYPE EVENT;
			},
			COMCALLBACK {
				STRING CALLBACKROUTINENAME;
				MESSAGE_TYPE MESSAGE[];
			},
			FLAG {
				STRING FLAGNAME;
			}
		] NOTIFICATION = NONE;
	};			

	COM {
		BOOLEAN COMERRORHOOK = FALSE;
		BOOLEAN COMUSEGETSERVICEID = FALSE;
		BOOLEAN COMUSEPARAMETERACCESS = FALSE;
		BOOLEAN COMSTARTCOMEXTENSION = FALSE;
		STRING COMAPPMODE[];
		ENUM [	COMSTANDARD, COMEXTENDED ] COMSTATUS = COMSTANDARD;
	};
	
	NM {
	};

};

CPU TestApp {

	NM hello:"A dummy description";
	
	OS ExampleOS {
		STATUS = STANDARD;
		STARTUPHOOK = TRUE;
		ERRORHOOK = TRUE;
		SHUTDOWNHOOK = TRUE;
		PRETASKHOOK = FALSE;
		POSTTASKHOOK = FALSE;
		USEGETSERVICEID = FALSE;
		USEPARAMETERACCESS = FALSE;
		USERESSCHEDULER = TRUE;
	};

	TASK TaskA {
		PRIORITY = 10;
		SCHEDULE = NON;
		ACTIVATION = 1;
		AUTOSTART = TRUE {
			APPMODE = AppMode1;
			APPMODE = AppMode2;
		};
		RESOURCE = resource1;
		RESOURCE = resource2;
		RESOURCE = resource3;
		EVENT = event1;
		EVENT = event2;
		MESSAGE = anyMesssage1;
	};

	COUNTER Timer {
		MINCYCLE = 16;
		MAXALLOWEDVALUE = 127;
		TICKSPERBASE = 90;
	};
	
	ALARM WakeTaskA {
		COUNTER = Timer;
		ACTION = SETEVENT {
			TASK = TaskA;
			EVENT = event1;
		};
		AUTOSTART = FALSE;
	};
	
	ALARM WakeTaskB {
		COUNTER = SysCounter;
		ACTION = ACTIVATETASK {
			TASK = TaskB;
		};
		AUTOSTART = TRUE {
			ALARMTIME = 50;
			CYCLETIME = 100;
			APPMODE = AppMode1;
			APPMODE = AppMode2;
		};
	};
	
	ALARM RunCallbackC {
		COUNTER = SysCounter;
		ACTION = ALARMCALLBACK {
			ALARMCALLBACKNAME = "CallbackC";
		};
		AUTOSTART = FALSE;
	};	

	RESOURCE MsgAccess
	{
		RESOURCEPROPERTY = STANDARD;
	};

	EVENT event1 {
		MASK = 0x01;
	};
	
	EVENT event2 {
		MASK = AUTO;
	};

	ISR TimerInterrupt {
		CATEGORY = 2;
		RESOURCE = someResource;
		MESSAGE= anyMessage2;
	};

	MESSAGE myMess1 {
		MESSAGEPROPERTY = SEND_STATIC_INTERNAL {
			CDATATYPE = "long";
		};
		NOTIFICATION = FLAG {
			FLAGNAME = "myMess1_finished";
		};
	};

	MESSAGE myMess2 {
		MESSAGEPROPERTY = RECEIVE_UNQUEUED_INTERNAL {
			INITIALVALUE = 0x12;
			SENDINGMESSAGE = myMess1;
		};
		
		NOTIFICATION = ACTIVATETASK {
			TASK = TaskA;
		};
	};

	MESSAGE myMess4 {
		MESSAGEPROPERTY = RECEIVE_QUEUED_INTERNAL {
			QUEUESIZE = 0x100;
			SENDINGMESSAGE = myMess1;
		};
		
		NOTIFICATION = SETEVENT {
			TASK = TaskA;
			EVENT = event1;
		};
	};
	
	COM ExampleCOM {
		COMERRORHOOK = TRUE;
		COMUSEGETSERVICEID = FALSE;
		COMUSEPARAMETERACCESS = FALSE;
		COMSTARTCOMEXTENSION = FALSE;
		COMAPPMODE = "COMNormalMode";
		COMAPPMODE = "COMDiagnosticMode";
		COMSTATUS = COMEXTENDED;
	};	

};