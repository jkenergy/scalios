



















  
  

  







<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<!-- Mirrored from 10.211.55.3/sf/wiki/do/viewPage/projects.ertcomsys/wiki/Components?selectedTab=associations by HTTrack Website Copier/3.x [XR&CO'2010], Sun, 03 Apr 2011 20:55:31 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
<head>
  <title>SourceForge : View Wiki Page: Components</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  
  <link rel="stylesheet" type="text/css" href="http://10.211.55.3/css/styles_new.css" />
  <link rel="shortcut icon" href="http://10.211.55.3/sf-images/icons/favicon.ico" />
  <script language="JavaScript" src="http://10.211.55.3/sf/js/sf_functions.js" type="text/javascript"></script>
  
  
  
  
</head>

  <body>


<!-- SourceForge masthead begin -->


<script type="text/javascript" src="http://10.211.55.3/sf-help/RoboHelp_CSH.js"></script>
<script type="text/javascript">
                      var helpRoot = '/sf-help/en/index.htm>HelpWin';
    
    // show help for a topic
    function showTopicHelp(topicId) {
	// First, close the help menu
	closeMenu(activeButton);
	RH_ShowHelp(0, helpRoot, HH_HELP_CONTEXT, topicId);
    }

    // show help for a topic
    function showTopicHelpDirectly(topicId) {
	RH_ShowHelp(0, helpRoot, HH_HELP_CONTEXT, topicId);
    }

    // show the help table of contents
    function showHelpContents() {
	// First, close the help menu
	closeMenu(activeButton);
	RH_ShowHelp(0, helpRoot, HH_DISPLAY_TOC, 0);
    }

    // show the help index
    function showHelpIndex() {
	// First, close the help menu
	closeMenu(activeButton);
	RH_ShowHelp(0, helpRoot, HH_DISPLAY_INDEX, 0);
    }

    // show the help index (not from a menu)
    function showHelpIndexFromLink() {
	RH_ShowHelp(0, helpRoot, HH_DISPLAY_INDEX, 0);
    }
</script>

<div id="ProjectMenu" class="menu">
      <a class="menuItem" href="http://10.211.55.3/sf/projects/ertcomsys">Scalios</a>
      <div class="menuItemSep"></div>
    <a class="menuItem" href="http://10.211.55.3/sf/sfmain/do/myProjects?selectedTab=my">My Projects</a>
    <a class="menuItem" href="http://10.211.55.3/sf/sfmain/do/myProjects?selectedTab=all">All Projects</a>
</div>

<div id="SearchMenu" class="menu">
  <a class="menuItem" href="http://10.211.55.3/sf/search/do/quickJump" onClick="window.open('/sf/search/do/quickJump', 'quickjumpwindow', 'width=540,height=263'); closeMenu(activeButton); return false">Quick Jump</a>
  <a class="menuItem" id="search" href="http://10.211.55.3/sf/search/do/search">Search</a>
</div>

<div id="HelpMenu2" class="menu">
    <a class="menuItem" href="javascript:showTopicHelp(16)">Help for this Page</a>
<a class="menuItem" href="javascript:showHelpContents()">Help Contents</a>
<a class="menuItem" href="javascript:showHelpIndex()">Help Index</a>
<a class="menuItem" href="http://10.211.55.3/sf-help/en/doc/User_Guide.pdf">User Guide</a>
<div class="menuItemSep"></div>
<a class="menuItem" href="http://10.211.55.3/sf/global/do/about" onclick="javascript:closeMenu(activeButton); window.open('/sf/global/do/about','sfpabout','height=450,width=600'); return false;">About SourceForge</a>
</div>

<table width="100%" border="0" cellpadding="0" cellspacing="0" class="mastHeadBackground">
 <tr>
  <td>
   <table width="300" border="0" cellpadding="0" cellspacing="0" class="mastHeadLink">
     <tr class="mastHeadLinkSpacing">
       <td nowrap="nowrap" valign="middle"><a href="http://10.211.55.3/sf/sfmain/do/home" target="_top"><img src="http://10.211.55.3/sf-images/masthead/logo-custom.gif" border="0" align="absmiddle"><img src="http://10.211.55.3/sf-images/masthead/logo.gif" border="0" align="absmiddle"></a></td>
                    <td nowrap="nowrap" class="mastHeadLink"><a href="http://10.211.55.3/sf/sfmain/do/home" target="_top">Home</a></td>
       <td nowrap="nowrap" class="mastHeadLinkSpacing"> </td>

                          <td nowrap="nowrap" class="mastHeadLink"><a href="http://10.211.55.3/sf/categorization/do/browse/projects/categorization.root" target="_top">Project Categories</a></td>
         <td nowrap="nowrap" class="mastHeadLinkSpacing"> </td>
       
               <td nowrap="nowrap" class="mastHeadLink"><a href="http://10.211.55.3/sf/sfmain/do/myPage" target="_top">My&nbsp;Workspace</a></td>
       <td nowrap="nowrap" class="mastHeadLinkSpacing"> </td>
       
               <td nowrap="nowrap" class="mastHeadLinkSelected"><a href="#" onclick="return buttonClick(this, 'ProjectMenu');">Projects<img src="http://10.211.55.3/sf-images/masthead/dropdown.gif" width="7" height="4" hspace="2" border="0"></a></td>
       <td nowrap="nowrap" class="mastHeadLinkSpacing"> </td>
               <td nowrap="nowrap" class="mastHeadLink"><a href="#" onclick="return buttonClick(this, 'SearchMenu');">Search<img src="http://10.211.55.3/sf-images/masthead/dropdown.gif" width="7" height="4" hspace="2" border="0"></a></td>

     
                          <td nowrap="nowrap" class="mastHeadLinkSpacing"> </td>
         <td nowrap="nowrap" class="mastHeadLink"><a href="https://sourceforge-enterprise.com" target="_blank">Community Support</a></td>
            
                 
     </tr>
   </table>
  </td>
  <td align="right">
    <table border="0" cellspacing="0" cellpadding="0" class="mastHeadLink">
      <tr class="mastHeadLink">
                  <td nowrap="nowrap" id="UserLoggedIn">Logged In:&nbsp;JK Energy&nbsp;<div id="CurrentUsername" style="display: none;">jkenergy</div></td>
          <td nowrap="nowrap"><img src="http://10.211.55.3/sf-images/masthead/vertical_line.gif" width="1" height="19" hspace="4"></td>
          <td nowrap="nowrap">&nbsp;<a href="#" onclick="return buttonClick(this, 'HelpMenu2');"><img src="http://10.211.55.3/sf-images/masthead/help.gif" width="21" height="21" border="0"></a></td>
          <td nowrap="nowrap">&nbsp;<a href="http://10.211.55.3/sf/sfmain/do/logout" target="_top"><img src="http://10.211.55.3/sf-images/masthead/logout.gif" alt="Logout" width="19" height="21" border="0"></a></td>
              </tr>
    </table>
  </td>
  </tr>
  <tr>
    <td colspan="2" class="black"><img src="http://10.211.55.3/sf-images/misc/pixel.gif" width="1" height="1"></td>
  </tr>
</table>

<!-- SourceForge masthead end -->

<!-- SourceForge buttonbar begin -->
<table class="TopMenu">
    <tr class="ButtonRow">
        <td class="VerticalSeparatorNoBorder"><img src="http://10.211.55.3/sf-images/misc/white.gif" border="0" height="40" width="1"></td>
                   <td class="Button " onclick="window.location = '/sf/projects/ertcomsys'; return false;"><a href="http://10.211.55.3/sf/projects/ertcomsys" target="_top"><img src="http://10.211.55.3/sf-images/project/project-homeicon.gif" width="25" height="20" border="0"><br>Project&nbsp;Home</a></td>
                  <td class="VerticalSeparator"><img src="http://10.211.55.3/sf-images/misc/white.gif" border="0" height="40" width="1"></td>
                             <td class="Button " onclick="window.location = '/sf/tracker/do/listTrackers/projects.ertcomsys/tracker'; return false;"><a href="http://10.211.55.3/sf/tracker/do/listTrackers/projects.ertcomsys/tracker" target="_top"><img src="http://10.211.55.3/sf-images/project/project-trackericon.gif" width="25" height="20" border="0"><br>Tracker</a></td>
                  <td class="VerticalSeparator"><img src="http://10.211.55.3/sf-images/misc/white.gif" border="0" height="40" width="1"></td>
                             <td class="Button " onclick="window.location = '/sf/docman/do/listDocuments/projects.ertcomsys/docman.root'; return false;"><a href="http://10.211.55.3/sf/docman/do/listDocuments/projects.ertcomsys/docman.root" target="_top"><img src="http://10.211.55.3/sf-images/project/project-documentsicon.gif" width="25" height="20" border="0"><br>Documents</a></td>
                  <td class="VerticalSeparator"><img src="http://10.211.55.3/sf-images/misc/white.gif" border="0" height="40" width="1"></td>
                             <td class="Button " onclick="window.location = '/sf/taskmgr/do/viewSummary/projects.ertcomsys/taskmgr'; return false;"><a href="http://10.211.55.3/sf/taskmgr/do/viewSummary/projects.ertcomsys/taskmgr" target="_top"><img src="http://10.211.55.3/sf-images/project/project-tasksicon.gif" width="25" height="20" border="0"><br>Tasks</a></td>
                  <td class="VerticalSeparator"><img src="http://10.211.55.3/sf-images/misc/white.gif" border="0" height="40" width="1"></td>
                             <td class="Button " onclick="window.location = '/sf/scm/do/listRepositories/projects.ertcomsys/scm'; return false;"><a href="http://10.211.55.3/sf/scm/do/listRepositories/projects.ertcomsys/scm" target="_top"><img src="http://10.211.55.3/sf-images/project/project-scmicon.gif" width="25" height="20" border="0"><br>Source&nbsp;Code</a></td>
                  <td class="VerticalSeparator"><img src="http://10.211.55.3/sf-images/misc/white.gif" border="0" height="40" width="1"></td>
                             <td class="Button " onclick="window.location = '/sf/discussion/do/listForums/projects.ertcomsys/discussion'; return false;"><a href="http://10.211.55.3/sf/discussion/do/listForums/projects.ertcomsys/discussion" target="_top"><img src="http://10.211.55.3/sf-images/project/project-forumsicon.gif" width="25" height="20" border="0"><br>Discussions</a></td>
                  <td class="VerticalSeparator"><img src="http://10.211.55.3/sf-images/misc/white.gif" border="0" height="40" width="1"></td>
                             <td class="Button " onclick="window.location = '/sf/reporting/do/listReports/projects.ertcomsys/reporting'; return false;"><a href="http://10.211.55.3/sf/reporting/do/listReports/projects.ertcomsys/reporting" target="_top"><img src="http://10.211.55.3/sf-images/project/project-reportsicon.gif" width="25" height="20" border="0"><br>Reports</a></td>
                  <td class="VerticalSeparator"><img src="http://10.211.55.3/sf-images/misc/white.gif" border="0" height="40" width="1"></td>
                             <td class="Button " onclick="window.location = '/sf/frs/do/viewSummary/projects.ertcomsys/frs'; return false;"><a href="http://10.211.55.3/sf/frs/do/viewSummary/projects.ertcomsys/frs" target="_top"><img src="http://10.211.55.3/sf-images/project/project-releasesicon.gif" width="25" height="20" border="0"><br>File Releases</a></td>
                                    <td class="SelectedLeft"><img src="http://10.211.55.3/sf-images/misc/pixel.gif" border="0" height="1" width="4"></td>
           <td class="Button Selected" onclick="window.location = '/sf/wiki/do/viewPage/projects.ertcomsys/wiki/HomePage'; return false;"><a href="HomePage.html" target="_top"><img src="http://10.211.55.3/sf-images/project/project-wikiicon.gif" width="25" height="20" border="0"><br>Wiki</a></td>
           <td class="SelectedRight"><img src="http://10.211.55.3/sf-images/misc/pixel.gif" border="0" height="1" width="4"/></td>
                  <td class="VerticalSeparatorNoBorder"><img src="http://10.211.55.3/sf-images/misc/white.gif" border="0" height="40" width="1"></td>
                             <td class="Button " onclick="window.location = '/sf/sfmain/do/projectAdmin/projects.ertcomsys'; return false;"><a href="http://10.211.55.3/sf/sfmain/do/projectAdmin/projects.ertcomsys" target="_top"><img src="http://10.211.55.3/sf-images/project/project-projectadminicon.gif" width="25" height="20" border="0"><br>Project&nbsp;Admin</a></td>
                  <td class="VerticalSeparator"><img src="http://10.211.55.3/sf-images/misc/white.gif" border="0" height="40" width="1"></td>
                           <td class="ButtonEnd"></td>
             </tr>

  <tr class="ShadowRow">
        
                  <td colspan="16"></td>
            <td class="SelectedLeft"></td>
      <td class="Selected"></td>
      <td class="SelectedRight"></td>
              <td colspan="4"></td>
  </tr>
  </table>

<!-- SourceForge buttonbar end -->

<!-- SourceForge content-area begin -->
<div class="contentArea">

<!-- SourceForge crumbs begin -->
<div style="padding-bottom: 2px;">
    <span class="searchlink">
        <a href="http://10.211.55.3/sf/wiki/do/searchWikiPages/projects.ertcomsys/wiki/Components" id="searchWikiPagesLink">Search Wiki Pages</a>
      </span>
    <span class="mainnavHeader"><strong class="ProjectProminent">Project: Scalios</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://10.211.55.3/sf/go/projects.ertcomsys/wiki">Wiki</a>&nbsp;&gt;&nbsp;</span><a href="Components.html">Components</a>&nbsp;&gt;&nbsp;<strong>View Wiki Page</strong>
  </div>
<!-- SourceForge crumbs end -->

<!-- SourceForge messages begin -->







<div style="padding-bottom: 2px; padding-top: 6px;">



</div>
<!-- SourceForge messages end -->

<!-- SourceForge content begin -->
<div style="padding-top: 10px; width: auto;">
    <table class="ItemDetailContainer">
      <tr class="ContainerHeader">
        <td>
          





          wiki1058: Components
          
        </td>
      </tr>
      <tr>
        <td class="ItemDetailContainerCell">
          <h4 id='section-Components-BasicIdea'>Basic idea</h4>
<p>The OS has been designed for use as a run-time platform for software components.
</p>
<p>A software component is a collection of baseline objects (tasks, resources, functions) and a set of external ports. A component is like a library, but it has local configuration objects (resources, tasks, etc.). The component is compiled twice: one as a &quot;singleton&quot; (i.e. there is a single instance of the component) and once as normal. Local accesses are via local handles, declared in the component header file. Accesses to other objects outside of the component are via ports. The name of the port is the local handle, and they are stored as variables with the values determined at link-time when the configuration is known.
</p>
<p>In principle it is possible to see <a class="editpage" title="Create 'COMImplementedAsComponents'" href="http://10.211.55.3/sf/wiki/do/createPage/projects.ertcomsys/wiki?pageName=COMImplementedAsComponents&amp;referrerPageName=Components">COM implemented as components</a>.
</p>
<h4 id='section-Components-Methods'>Methods</h4>
<p>A component can include a function, accessed via a port, that performs some computation. A method has known access patterns to local objects or objects via ports (e.g. resources) and to components by type (e.g. &quot;all message components&quot; for a communications protocol component). There are also known access patterns from tasks and methods to other methods. Thus it becomes possible to work out which tasks can access which objects (in particular which resources, since this is used to compute the ceiling).
</p>
<h4 id='section-Components-Implementation'>Implementation</h4>
<p>A component has a control block which contains handles to the local members, and the handles for the external ports. This is pointed to by the global variable <tt>os_this</tt> which is context switched automatically by the OS.
</p>
<p>The component header file contains handles which are macros that access the control block. For example, consider a component that consists of two external functions (fA, fB), a local task (tC), a local resource (rD), and links to an external receive stream message (mE).
</p>
<p>The control block declaration like this:
</p>
<pre>struct AComponentControlBlock {
  char (*fA) (int, int);
  void (*fB)();
  TaskType tC;
  ResourceType rD;
  MessageIdentifier mE;
};</pre>

<p>The header file for the component declares the local handle macros thus:
</p>
<p><tt>#define tC ((const struct <a class="editpage" title="Create 'AComponentControlBlock'" href="http://10.211.55.3/sf/wiki/do/createPage/projects.ertcomsys/wiki?pageName=AComponentControlBlock&amp;referrerPageName=Components">AComponentControlBlock</a> *)(os_this)-&gt;tC)</tt>
</p>
<p>The generated C code includes the following:
</p>
<p><tt>const struct <a class="editpage" title="Create 'AComponentControlBlock'" href="http://10.211.55.3/sf/wiki/do/createPage/projects.ertcomsys/wiki?pageName=AComponentControlBlock&amp;referrerPageName=Components">AComponentControlBlock</a> AComponentControlBlock_instance1 = {..., ..., ..., ..., ...};</tt>
</p>
<p>The control block is initialized to the appropriate object handles as determined by traversing the system model.
</p>
<h4 id='section-Components-ComponentHeaderFile'>Component header file</h4>
<p>Note that the header file for a component is generated at <i>component time</i>: i.e. the header file is generated when the component structure is known, but before any system has been assembled. In order for the component to build, the standard library header files for the OS and COM are included (oslib.h and comlib.h). Also the component tool generates a header file that declares the component control block structure (<tt><a class="editpage" title="Create 'AComponentControlBlock'" href="http://10.211.55.3/sf/wiki/do/createPage/projects.ertcomsys/wiki?pageName=AComponentControlBlock&amp;referrerPageName=Components">AComponentControlBlock</a></tt> in the above example) and the handles. From this the component can be compiled. Note that the header file will be compiled against twice: once for a singleton component and once for a multiply-instantiated component. The singleton component version of the header file (selected via the SINGLETON_COMPONENT #define symbol) defines handles that refer directly to the declared objects (since there will be just one instance of each declared object) rather than using the handles in the component control block.
</p>
<p>The task control block includes an additional member: <tt>this</tt> (declared as an anonymous struct pointer) which is initialized to point to the component control block that contains the task. The OS initializes a global variable called <tt>os_this</tt> to the value in the task control block when the task is dispatched, saving and restoring the previous value (just like variables such as <tt>os_curpri</tt> are handled).
</p>
<p>The control block does not contain handles to the local functions since they are simply accessed and named as normal C functions (function code in components is shared across all instances) by the rest of the code (e.g. the task body).
</p>
<p>The external functions are accessed via function pointers, and are initialized to point to the functions wired up in the overall system diagram. If the destination component is a singleton then the pointers point directly to the appropriate functions. If the component has multiple instances in the model then the reference points to a <i>thunk</i>. A thunk is a function placed in the generated C, called <tt>os_thunk_</tt><i>nnnn</i>, one for each reference to a function in a non-singleton component. The thunk performs a switch of the <tt>os_this</tt> variable and is declared to have the same prototype as the target function. For example, if function fA in the example is declared as taking two ints and returning a char then the thunk is of this form:
</p>
<pre>char os_thunk_1234(int a, int b)
{
  const struct os_componentcb *tmp = os_this; /* os_componentcb is the anonymous struct type for os_this */
  char ret;
  os_this = (const struct os_componentcb *)&amp;AnotherComponentControlBlock_instance3;
  ret = fnX(a, b);
  os_this = tmp;
  return ret;
};</pre>

<p>In the above code <tt>fnX</tt> is the name of the destination function in the component. It might be possible to write these functions in the component using a macro METHOD:
</p>
<pre>char METHOD(fnX)(int a, int b) {
...
};</pre>

<p>where the macro METHOD is defined in the component header file (differently for each component) that places a component namespace prefix on the function (similarly to the TASK macro).
</p>
<p>It should be noted that the thunk approach lends itself neatly to defining <i>protected methods</i>, where the functions are defined to be mutually exclusive (i.e. a resource lock is made before calling the function).
</p>
<h4 id='section-Components-ComponentHandles'>Component handles</h4>
<p>It is possible to have a handle to a component: the <tt>os_this</tt> variable is initialized with them. The handle is of little value without knowing the type of the component, since a cast to the correct struct pointer is required. But if the type is known (e.g. a &quot;friend&quot; component) then the internal details can be accessed. In this way it is possible to build a new API: a global library which takes handles to a component of a particular type, and then calls the appropriate functions on the passed handle. A file system might work this way, with the file descriptor being a component (a task, a resource, etc.), and the file functions operating on the contents of the file descriptor (waking the task when data is available, for example).
</p>
<p>Some care is necessary when using component handles because the accessors to resources are not computable at build-time: the resource ceilings will not be completely worked out automatically and manual intervention will be required to indicate which tasks make the accesses.
</p>
<h4 id='section-Components-SingletonComponents'>Singleton components</h4>
<p>If a component is a singleton, it is possible to promote the accessor ports to global handles. This is an easy way to add an API to a system: a singleton component with member functions that can be accessed directly (without using a thunk). However, there are problems: the access patterns are lost since any function (or task body) can access the ports directly and the ceiling issue on the resources re-emerges.
</p>
<h4 id='section-Components-OILIssues'>OIL issues</h4>
<p>OIL could be extended to describe components. This would basically list the methods, list the resources, tasks, messages, etc. (perhaps giving details of the restrictions on the types, such as a basic or an extended task, a receive message, and so on). A component-only OIL file would produce component header files (as described above).
</p>
<p>An OIL description could also indicate how components were wired up/used.</p>

          
            
          







        </td>
      </tr>
      <tr class="ContainerFooter">
        <td>
          <div class="AlignRight">
            
            
            
              <div class="Button"><div class="Left">&nbsp;</div><div class="Middle"><a href="http://10.211.55.3/sf/wiki/do/editPage/projects.ertcomsys/wiki/Components?wikiPageVersion=-1" id="view_wiki_page.edit">Edit</a></div><div class="Right">&nbsp;</div></div>

            
            
          </div>
        </td>
      </tr>
    </table>

    <br/>

    

    

    <br/>
    
      <div class="AlignLeft">
        <div class="Button" id="_SfButton_showPageDetails"><div class="Left">&nbsp;</div><div class="Middle">
          <img src="http://10.211.55.3/sf-images/icons/plus_minus_closed.gif" style="vertical-align: middle;">
          <a href="Components962a.html?showDetails=true">Show Details</a>
        </div><div class="Right">&nbsp;</div></div>

      </div>
    

    <div class="AlignRight">
      
      







    
    <div class="Button"><div class="Left">&nbsp;</div><div class="Middle">
	<a href="javascript:NewWindow('http://10.211.55.3/sf/sfmain/do/listMonitoringUsers/projects.ertcomsys/wiki/?objid=wiki1058', 'monusers', 540, 425, 'no');" class="menuItem">Users Monitoring</a>
    </div><div class="Right">&nbsp;</div></div>

    
	
	
	    <div class="Button"><div class="Left">&nbsp;</div><div class="Middle"><a href="http://10.211.55.3/sf/sfmain/do/monitor/projects.ertcomsys/wiki/Components?monitorReturnTo=http%3A%2F%2Flocalhost%3A8080%2Fsf%2Fwiki%2Fdo%2FviewPage%2Fprojects.ertcomsys%2Fwiki%2FComponents%3FselectedTab%3Dassociations" id="button_monitor_object">Monitor</a></div><div class="Right">&nbsp;</div></div>

	
    

    </div>
  </div>
<!-- SourceForge content end -->

</div>
<!-- SourceForge content-area end -->

<div id="PageLoaded" style="display: none;"></div>


</body>

<!-- Mirrored from 10.211.55.3/sf/wiki/do/viewPage/projects.ertcomsys/wiki/Components?selectedTab=associations by HTTrack Website Copier/3.x [XR&CO'2010], Sun, 03 Apr 2011 20:55:31 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
</html>

